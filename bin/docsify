#!/usr/bin/env node

'use strict'

const pkg = require('../package.json')
const run = require('../lib')
const chalk = require('chalk')
const updateNotifier = require('update-notifier')

updateNotifier({ pkg: pkg }).notify()

const Locales = require('./locales')
const y18n = new Locales()

require('yargonaut')
  .style('yellow', 'required')
  .helpStyle('green')
  .errorsStyle('red.bold')

var yargs = require('yargs')
  .usage(chalk.bold(y18n.__('usage') + ': docsify <command> <path> [options]'))
  .command({
    command: '*',
    desc: 'the default command',
    builder: () => {},
    handler: (yargs) => {
      yargs.help()
    }
  })
  .command({
    command: 'init <path> [--local] [--theme vue]',
    alias: 'i',
    desc: chalk.gray(y18n.__('init')),
    builder: (yargs) => yargs.options({
      'local': {
        alias: 'l',
        default: false,
        desc: chalk.gray(y18n.__('init.local')),
        nargs: 0,
        requiresArg: false,
        type: 'boolean'
      },
      'theme': {
        alias: 't',
        default: 'vue',
        desc: chalk.gray(y18n.__('init.theme')),
        choices: ['vue', 'buble', 'dark', 'pure'],
        nargs: 1,
        requiresArg: true,
        type: 'string'
      }
    }),
    handler: (argv) => run.init(argv.path, argv.local, argv.theme)
  })
  .command({
    command: 'serve <path> [--port 3000]',
    alias: 's',
    desc: chalk.gray(y18n.__('serve')),
    builder: (yargs) => yargs.options({
      'port': {
        alias: 'p',
        default: 3000,
        desc: chalk.gray(y18n.__('serve.port')),
        nargs: 1,
        requiresArg: true,
        type: 'number'
      }
    }),
    handler: (argv) => run.serve(argv.path, argv.port)
  })
  .help()
  .option('help', {
    alias: 'h',
    type: 'boolean',
    default: true,
    desc: chalk.gray(y18n.__('help'))
  })
  .version('\ndocsify-cli version:\n  ' + pkg.version + '\n')
  .option('version', {
    alias: 'v',
    type: 'boolean',
    desc: chalk.gray(y18n.__('version'))
  })
  .epilog(chalk.green(y18n.__('epilog')) + ':\n' +
          '  https://QingWei-Li.github.io/docsify\n' +
          '  https://QingWei-Li.github.io/docsify-cli\n')
  .argv
