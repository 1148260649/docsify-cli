#!/usr/bin/env node

'use strict'

const pkg = require('../package.json')
const cliVersion = pkg.version
const updateNotifier = require('update-notifier')
const Y18n = require('y18n')
const run = require('../src')

updateNotifier({ pkg: pkg }).notify()

const y18n = Y18n({
  directory: '../locales',
  updateFiles: false
})

require('yargonaut')
  .style('yellow', 'required')
  .helpStyle('green')
  .errorsStyle('red.bold')

var argv = require('yargs')
  .usage('Usage: $0 <command> [options]', {
    'init': {
      desc: 'create new docs',
      short: 'i'
    },
    'serve': {
      desc: 'run serve to preview',
      short: 's'
    }
  })
  .command({
    command: 'init <path> [--local] [--theme vue]',
    alias: 'i',
    desc: 'create new docs',
    builder: (yargs) => return yargs
      .option('l', {
          alias: 'local',
          type: 'boolean',
          default: false,
          desc: 'Copy docsify files to local. Default is false.'
        })
        .option('t', {
          alias: 'theme',
          type: 'string',
          default: 'vue',
          choices: ['vue', 'buble', 'dark', 'pure'],
          desc: 'Theme file to be used.'
        }),
    handler: (argv) => run.init
  })
  .command({
    command: 'serve <path> [--port 3000]',
    alias: 's',
    desc: 'run serve to preview',
    builder: (yargs) => return yargs
      .option('p', {
          alias: 'port',
          type: integer,
          default: 3000,
          desc: 'listen port'
        }),
    handler: (argv) => run.serve
  })
  .option('h', {
    alias: 'help',
    type: 'boolean',
    desc: 'Show help'
  })
  .option('v', {
    alias: 'version',
    type: 'boolean',
    desc: 'Show version number'
  })
  .help('help')
  .version(cliVersion, 'version', 'Show version number')
  .example('docsify init --local "./docs"')
  .epilog('Read more about docsify on:\n' +
    '\thttps://QingWei-Li.github.io/docsify\n' +
    '\thttps://QingWei-Li.github.io/docsify-cli')
  .showHelpOnFail(false, 'Something went wrong! Run --help')
  .updateStrings(function (obj) {
    y18n.updateLocale(obj)
  })
  .argv
